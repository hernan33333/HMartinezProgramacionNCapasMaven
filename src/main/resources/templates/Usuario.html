<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html>
    <head>
        <title>GetAllUsuario</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    </head>
    <body>
        
        <header class="position-sticky">
            
            <div class="position-relative">
                <h1 class="position-absolute top-100 start-50 translate-middle mt-1">GetAll</h1>
            </div>
            
        </header>
        
        <div class="container position-relative">
            
            <div class="mx-auto mt-5">
                
                <div class="table-responsive-xl">
                
                    <table class="table table-hover table-borderless">
                        <thead class="border-color">
                            <tr>
                                <th scope="col">
                                    <div class="position-relative" style="height: 10px">
                                        <span class="position-absolute top-0 start-50 translate-middle">Acciones</span>
                                    </div>
                                    <a class="btn btn-success btn-sm" th:href="@{usuario/formulario}">
                                        <i class="bi bi-person-plus-fill"></i>
                                        Agregar
                                    </a>
                                </th>
                                <th scope="col">
                                    <div class="position-relative" style="height: 30px">
                                        <span class="position-absolute top-0 start-50 translate-middle">Usuario</span>
                                    </div>
                                </th>
                                <th scope="col">
                                    <div class="position-relative" style="height: 30px">
                                        <span class="position-absolute top-0 start-50 translate-middle">Datos de contacto</span>
                                    </div>
                                </th>
                                <th scope="col">
                                    <div class="position-relative" style="height: 30px">
                                        <span class="position-absolute top-0 start-50 translate-middle">Direcciones</span>
                                    </div>
                                </th>
                                <th scope="col">
                                    <div class="position-relative" style="height: 30px">
                                        <span class="position-absolute top-0 start-50 translate-middle">Rol</span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="usuario : ${usuarios}">
                                <td class="me-2">
                                    <div class="row">
                                        <div class=" col-12 d-flex justify-content-center align-items-center">
                                            <img th:src="'data:image/jpeg;base64,' + ${usuario.Imagen}" alt="imagenUsuario" style="max-width: 100px;max-height: auto" th:if="${usuario.Imagen != null}"/>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16" th:if="${usuario.Imagen == null}">
                                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                                            </svg>
                                        </div>
                                        <a class="btn btn-warning col-lg-6 col-md-12 ms-2 me-2 mt-2 d-flex flex-column align-items-center" th:href="@{/usuario/getbyid/{idusuario}(idusuario= ${usuario.IdUsuario})}" style="width: 45px;height: 60px; font-size: 10px">
                                            <i class="bi bi-pen-fill" style="font-size: 15px"></i>
                                            <span class="mt-auto mb-auto">Editar</span>
                                        </a>
                                        <button class="btn btn-danger col-lg-6 col-md-12 mt-2 d-flex flex-column align-items-center" style="width: 45px;height: 60px;font-size: 10px" th:onclick="'ConfirmarEliminacion(' + ${usuario.IdUsuario} + ')'">
                                            <i class="bi bi-trash3-fill" style="font-size: 15px"></i>
                                            <span class="mt-auto mb-auto">Eliminar</span>
                                        </button>
                                    </div>
                                </td>
                                <td class="me-2">
                                    <div class="row">
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-person-circle col-2"></i>
                                            <b class="col-10" style="font-size: 15px" th:text="|${usuario.Nombre} ${usuario.ApellidoPaterno} ${usuario.ApellidoMaterno ?: ''}|"></b>
                                        </div>
                                        
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-person-badge-fill col-2"></i>
                                            <span class="col-10 text-body-secondary font-monospace fw-medium" th:text="${usuario.UserName}"></span>
                                        </div>
                                        
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-gender-ambiguous col-2"></i>
                                            <button class="btn btn-success col-10" disabled th:text="${usuario.Sexo}"></button>
                                        </div>
                                        
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-cake2-fill col-2"></i>
                                            <b class="col-10" th:text="${usuario.FechaNacimiento}"></b>
                                        </div>
                                    </div>
                                </td>
                                <td class="me-2">
                                    <div class="row">
                                        
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-envelope-at-fill col-2"></i>
                                            <span class="col-10 text-body-secondary font-monospace fw-medium" th:text="${usuario.Email}"></span>
                                        </div>
                                        
                                        <div class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-telephone-fill col-2"></i>
                                            <span class="col-10" th:text="${usuario.Telefono}"></span>
                                        </div>
                                    </div>
                                </td>
                                <td class="row me-2">
                                    
                                    <div class="row">
                                        <div th:each="direccion : ${usuario.Direcciones}" class="row col-12 justify-content-center align-items-center">
                                            <i class="bi bi-geo-fill col-1"></i>
                                            <span class="col-11" th:text="|${direccion.Calle} ${direccion.NumeroExterior} ${direccion.NumeroInterior},
                                               ${direccion.Colonia.Nombre} ${direccion.Colonia.CodigoPostal}, ${direccion.Colonia.Municipio.Nombre}
                                                ${direccion.Colonia.Municipio.Estado.Nombre}, ${direccion.Colonia.Municipio.Estado.Pais.Nombre}.|">
                                            </span>
                                        </div>
                                    </div>
                                </td>
                                <td class="me-2">
                                    <div class="row col-12 justify-content-center align-items-center">
                                        <i class="bi bi-git col-3"></i>
                                        <span class="col-9" th:text="${usuario.Rol.Nombre}"></span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                
            </div>
            
        </div>
        
        <footer>
            
        </footer>
        
    </body>
    <script th:if="${successMessage}" th:inline="javascript">
        Swal.fire({
            title: "Usuario agregado correctamente",
            icon: "success",
            draggable: true
        });
    </script>
    
    <script>
        function ConfirmarEliminacion(IdUsuario){
            
            Swal.fire({
                title: "¿Está seguro que quiere eliminar al usuario?",
                text: "No se podrán revertir los cambios",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                cancelButtonText: "No, cancelar",
                confirmButtonText: "Sí, eliminar"
            }).then((result) => {
                
              if (result.isConfirmed) {
                  
                Swal.fire({
                    title: 'Eliminando...',
                    text: 'Por favor, espere',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });  
                
                $.ajax({
                   
                    url:"usuario/eliminarusuario/" + IdUsuario,
                    type:"DELETE",
                    dataType:"json",
                    success: function(data, textStatus, jqXHR){
                        
                        if (data.correct) {
    
                            Swal.fire({
                                title: "¡Usuario eliminado!",
                                text: "Se eliminó correctamente al usuario y sus direcciones.",
                                icon: "success",
                                didClose: () => {
                                    location.reload(true);
                                }
                            });
                        } else {
                            
                            Swal.fire({
                                icon: "error",
                                title: "¡Algo salió mal!",
                                text: "No se pudo eliminar al usuario.",
                                didClose: () => {
                                    location.reload(true);
                                }
                            });
                            
                        }
                        
                        
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        
                        Swal.fire({
                            icon: "error",
                            title: "¡Algo salió mal!",
                            text: "Hubo un problema al intentar conectar con el servidor.",
                            didClose: () => {
                                location.reload(true);
                            }
                        });
                    }
                    
                });
                
              }
            });
        }
        
    </script>
    
</html>

